<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<script>

let fetchUrl = "http://127.0.0.1:8000/chat/"

async function fetchData() {
    let response = await fetch(fetchUrl)
    
    let data = await response.json()
    console.log(data[0]);

    let chatWindow = document.getElementById('chat_window');
    chatWindow.innerHTML = "";
    data.forEach(chat => {
        chatWindow.innerHTML += `
            <div class="message_box">
                <b class="user_name">${chat.name} - ${chat.created_at}:</b> <br>
                <span class="text_content">${chat.message}</span>
            </div>
        `;
    });
    
}

async function sendMessage() {
    let data = {
        "name": name_input.value,
        "message": message_input.value,
    }

    let response = await fetch(fetchUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });

    let result = await response.json();
    console.log(result);
    let msgInput = document.getElementById('message_input');
    msgInput.value = "";
    fetchData()
}

fetchData()

</script>
<body>
    <h1>Chaty</h1>
    
    <div id="chat_window">
        
    </div>
    <div id="input_window">  
        <input id=name_input type="text" placeholder="Namen...">
        <input id=message_input type="text" placeholder="Message...">
        <button id="button_send" onclick="sendMessage()">Senden</button>
    </div>
    
</body>
</html>